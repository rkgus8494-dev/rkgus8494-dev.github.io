<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì›”ê°„ ì†Œë¹„ ì ê²€ ì‹œìŠ¤í…œ (Lite)</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple SD Gothic Neo", "Noto Sans KR", sans-serif; }
    body { margin: 0; background: #f6f7f9; color: #111; }
    .wrap { max-width: 920px; margin: 0 auto; padding: 18px; }
    .card { background: #fff; border-radius: 14px; box-shadow: 0 6px 20px rgba(0,0,0,.06); padding: 16px; }
    h1 { font-size: 20px; margin: 0 0 10px; }
    h2 { font-size: 16px; margin: 18px 0 10px; }
   .tabs { display:flex; gap:10px; margin: 12px 0; flex-wrap: wrap; }

.tab {
  border: 1px solid #ddd;
  background: #f1f1f1;
  padding: 10px 16px;
  border-radius: 999px;
  cursor: pointer;

  /* ğŸ‘‡ ê¸€ì ë¬´ì¡°ê±´ ë³´ì´ê²Œ */
  color: #111 !important;
  font-weight: 700;
  font-size: 14px;
  line-height: 1;
}

.tab.active {
  border-color: #111;
  background: #111;

  /* ğŸ‘‡ activeì¼ ë•Œ í° ê¸€ì */
  color: #fff !important;
}
    .row { display:grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    @media (max-width: 720px){ .row{ grid-template-columns:1fr; } }
    label { display:block; font-size: 12px; margin: 10px 0 6px; color:#333; }
    input, select { width:100%; padding: 10px; border:1px solid #ddd; border-radius: 10px; background:#fff; }
    button { padding: 10px 12px; border-radius: 10px; border: 1px solid #111; background: #111; color:#fff; cursor:pointer; }
    button.ghost { background:#fff; color:#111; border-color:#ddd; }
    .muted { color:#666; font-size: 12px; }
    .pill { display:inline-block; padding: 4px 10px; border-radius: 999px; border:1px solid #ddd; font-size: 12px; }
    table { width:100%; border-collapse: collapse; }
    th, td { padding: 10px; border-bottom:1px solid #eee; font-size: 13px; vertical-align: top; }
    th { text-align:left; color:#444; font-size: 12px; }
    .danger { color:#b00020; font-weight: 600; }
    .ok { color:#0a7a2f; font-weight: 600; }
    .right { text-align:right; }
    .actions { display:flex; gap:8px; flex-wrap: wrap; margin-top: 12px; }
    .grid3 { display:grid; grid-template-columns: repeat(3,1fr); gap:10px; }
    @media (max-width: 720px){ .grid3{ grid-template-columns:1fr; } }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>ì›”ê°„ ì†Œë¹„ ì ê²€ ì‹œìŠ¤í…œ (Lite)</h1>
      <div class="muted">ë¡œê·¸ì¸ ì—†ì´ ì‚¬ìš© Â· ë¸Œë¼ìš°ì €ì— ìë™ ì €ì¥ë©ë‹ˆë‹¤.</div>

<div class="tabs">
  <button class="tab active" type="button" data-tab="diagnosis">ì§„ë‹¨</button>
  <button class="tab" type="button" data-tab="log">ê¸°ë¡</button>
  <button class="tab" type="button" data-tab="report">ë¦¬í¬íŠ¸</button>
</div>

      <!-- ì§„ë‹¨ -->
      <section id="diagnosis">
        <h2>ì†Œë¹„ ê°€ì¹˜ ì§„ë‹¨ (10ë¬¸í•­)</h2>
        <div class="muted">ê° ë¬¸í•­ì„ 1~5ì ìœ¼ë¡œ ì²´í¬í•˜ì„¸ìš”. (1=ì „í˜€ ì•„ë‹ˆë‹¤, 5=ë§¤ìš° ê·¸ë ‡ë‹¤)</div>
        <div id="qList"></div>

        <div class="actions">
          <button id="calcType">ìœ í˜• ê²°ê³¼ ë³´ê¸°</button>
          <button class="ghost" id="resetAll">ì „ì²´ ì´ˆê¸°í™”</button>
        </div>

        <div id="typeResult" style="margin-top:12px;"></div>
      </section>

      <!-- ê¸°ë¡ -->
      <section id="log" style="display:none;">
        <h2>ì†Œë¹„ ê¸°ë¡</h2>

        <div class="row">
          <div>
            <label>ë‚ ì§œ</label>
            <input id="dDate" type="date" />
          </div>
          <div>
            <label>í•­ëª©</label>
            <input id="dItem" placeholder="ì˜ˆ: ì»¤í”¼, íƒì‹œ, ì±…" />
          </div>
        </div>

        <div class="row">
  <div>
    <label>ê¸ˆì•¡(ì›)</label>
    <input id="dAmount" type="number" min="0" step="100" placeholder="ì˜ˆ: 4500" />
  </div>

  <div>
    <label>ì¹´í…Œê³ ë¦¬</label>
    <select id="dCategory">
      <option value="ì‹ë¹„">ì‹ë¹„</option>
      <option value="ì¹´í˜/ê°„ì‹">ì¹´í˜/ê°„ì‹</option>
      <option value="êµí†µ">êµí†µ</option>
      <option value="ì‡¼í•‘">ì‡¼í•‘</option>
      <option value="ìƒí™œ">ìƒí™œ</option>
      <option value="ê±´ê°•">ê±´ê°•</option>
      <option value="êµ¬ë…">êµ¬ë…</option>
      <option value="ê¸°íƒ€" selected>ê¸°íƒ€</option>
    </select>
  </div>
</div>

<div class="row">
  <div>
    <label>ê°ì •</label>
    <select id="dEmotion">
      <option value="ìŠ¤íŠ¸ë ˆìŠ¤">ìŠ¤íŠ¸ë ˆìŠ¤</option>
      <option value="ì§€ë£¨í•¨">ì§€ë£¨í•¨</option>
      <option value="ì„¤ë ˜">ì„¤ë ˜</option>
      <option value="ë³´ìƒ">ë³´ìƒ</option>
      <option value="í•„ìš”">í•„ìš”</option>
      <option value="ìŠµê´€">ìŠµê´€</option>
    </select>
  </div>

  <div>
    <label>ë§Œì¡±ë„ (1~5)</label>
    <select id="dSatis">
      <option>1</option><option>2</option><option selected>3</option><option>4</option><option>5</option>
    </select>
  </div>
</div>

<div class="row">
  <div>
    <label>í•„ìš”ë„ (1~5)</label>
    <select id="dNeed">
      <option>1</option><option>2</option><option selected>3</option><option>4</option><option>5</option>
    </select>
  </div>
  <div></div>
</div>

        <div class="row">
          <div>
            <label>ë§Œì¡±ë„ (1~5)</label>
            <select id="dSatis">
              <option>1</option><option>2</option><option selected>3</option><option>4</option><option>5</option>
            </select>
          </div>
          <div>
            <label>í•„ìš”ë„ (1~5)</label>
            <select id="dNeed">
              <option>1</option><option>2</option><option selected>3</option><option>4</option><option>5</option>
            </select>
          </div>
        </div>

        <div class="actions">
          <button id="addRow">ê¸°ë¡ ì¶”ê°€</button>
          <button class="ghost" id="clearLogs">ê¸°ë¡ ì „ì²´ ì‚­ì œ</button>
        </div>

        <h2 style="margin-top:18px;">ê¸°ë¡ ëª©ë¡</h2>
        <div class="muted">í›„íšŒ ì ìˆ˜ = (5-ë§Œì¡±ë„) + (5-í•„ìš”ë„) / 6 ì´ìƒì´ë©´ â€œí›„íšŒ ê°€ëŠ¥ì„± ë†’ìŒâ€</div>

        <div style="overflow:auto; margin-top:10px;">
          <table>
            <thead>
              <tr>
                <th>ë‚ ì§œ</th>
                <th>í•­ëª©</th>
                <th class="right">ê¸ˆì•¡</th>
                <th>ê°ì •</th>
                <th>ë§Œì¡±/í•„ìš”</th>
                <th>í›„íšŒ</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="logTbody"></tbody>
          </table>
        </div>
      </section>

      <!-- ë¦¬í¬íŠ¸ -->
      <section id="report" style="display:none;">
        <h2>ì›”ê°„ ë¦¬í¬íŠ¸</h2>
        <div class="row" style="margin-top:10px;">
  <div>
    <label>ë¦¬í¬íŠ¸ ì›”</label>
    <select id="monthSelect"></select>
    <div class="muted">ê¸°ë³¸ì€ ì´ë²ˆ ë‹¬ì…ë‹ˆë‹¤.</div>
  </div>
  <div style="display:flex; align-items:flex-end; gap:8px;">
    <button id="btnDownloadCsv" class="ghost" type="button" style="width:auto;">CSV ë‹¤ìš´ë¡œë“œ</button>
  </div>
</div>
        <div class="grid3" id="kpis"></div>

        <h2>ê°ì • TOP</h2>
        <div id="emotionTop" class="muted">ê¸°ë¡ì„ ì¶”ê°€í•˜ë©´ í‘œì‹œë©ë‹ˆë‹¤.</div>

        <h2>í•œ ì¤„ ì „ëµ</h2>
        <div id="strategy" class="card" style="box-shadow:none; border:1px solid #eee; background:#fafafa;"></div>
      </section>
    </div>
  </div>

<script>
  const KEY = "spend_lite_v1";
  const state = load() ?? { answers: Array(10).fill(3), logs: [] };

  function load(){ try { return JSON.parse(localStorage.getItem(KEY)); } catch { return null; } }
  function save(){ localStorage.setItem(KEY, JSON.stringify(state)); }

  document.querySelectorAll(".tab").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      document.querySelectorAll(".tab").forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      const tab = btn.dataset.tab;
      ["diagnosis","log","report"].forEach(id=>{
        document.getElementById(id).style.display = (id===tab) ? "block" : "none";
      });
      if(tab==="report") renderReport();
      if(tab==="log") renderLogs();
    });
  });

  const questions = [
    { text:"ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë°›ìœ¼ë©´ ì†Œë¹„ë¡œ ê¸°ë¶„ì„ í‘¼ë‹¤.", map:{R:1,E:1}},
    { text:"í•„ìš”í•˜ì§€ ì•Šìœ¼ë©´ ì›¬ë§Œí•˜ë©´ ì‚¬ì§€ ì•ŠëŠ”ë‹¤.", map:{S:1,G:0.5}},
    { text:"ê¸°ë¶„ì´ ì¢‹ì„ ë•Œ(ì„¤ë ˜) ë” ì‰½ê²Œ ê²°ì œí•œë‹¤.", map:{E:1,R:0.5}},
    { text:"ëˆì€ ì„±ì¥(ë°°ì›€/ë„êµ¬)ì— ì“°ëŠ” ê²Œ ì•„ê¹ì§€ ì•Šë‹¤.", map:{G:1}},
    { text:"ì„¸ì¼/í•œì •/ì˜¤ëŠ˜ë§Œ ê°™ì€ ë§ì— ì•½í•œ í¸ì´ë‹¤.", map:{E:1,R:0.5}},
    { text:"ì†Œë¹„í•˜ê¸° ì „ì— ë¹„êµ/ê²€í† ë¥¼ ê¼¼ê¼¼íˆ í•œë‹¤.", map:{S:0.5,G:1}},
    { text:"ê³„íšëŒ€ë¡œ ì“°ì§€ ëª»í•˜ë©´ ë¶ˆì•ˆí•´ì§„ë‹¤.", map:{S:1}},
    { text:"ì†Œë¹„ëŠ” ë‚˜ì—ê²Œ â€˜ë³´ìƒâ€™ì´ ë  ë•Œê°€ ë§ë‹¤.", map:{R:1}},
    { text:"ì§€ë£¨í•˜ë©´ ì‡¼í•‘/ë°°ë‹¬ì•±ì„ ì¼ ë‹¤.", map:{E:1,R:0.5}},
    { text:"ëª©í‘œê°€ ìˆìœ¼ë©´ ì†Œë¹„ë„ ê·¸ ëª©í‘œì— ë§ì¶˜ë‹¤.", map:{G:1,S:0.5}},
  ];

  const qList = document.getElementById("qList");
  questions.forEach((q, i)=>{
    const div = document.createElement("div");
    div.style.marginTop = "10px";
    div.innerHTML = `
      <label>${i+1}. ${q.text}</label>
      <select data-q="${i}">
        ${[1,2,3,4,5].map(v=>`<option value="${v}" ${state.answers[i]==v?"selected":""}>${v}</option>`).join("")}
      </select>
    `;
    qList.appendChild(div);
  });

  qList.addEventListener("change", (e)=>{
    const sel = e.target;
    const idx = Number(sel.dataset.q);
    if(Number.isFinite(idx)){
      state.answers[idx] = Number(sel.value);
      save();
    }
  });

  function calcType(){
    const scores = {R:0,S:0,E:0,G:0};
    state.answers.forEach((ans, i)=>{
      const w = questions[i].map;
      for(const k of Object.keys(w)){ scores[k] += ans * w[k]; }
    });
    const pairs = Object.entries(scores).sort((a,b)=>b[1]-a[1]);
    return {scores, top1:pairs[0][0], top2:pairs[1][0]};
  }

  const typeName = {R:"ğŸ’ ë³´ìƒí˜•", S:"ğŸŒ¿ ì•ˆì •í˜•", E:"ğŸŒŠ ê°ì •í˜•", G:"ğŸ¯ ëª©í‘œí˜•"};
  const typeDesc = {
    R:"ìŠ¤íŠ¸ë ˆìŠ¤/í”¼ë¡œ ìƒí™©ì—ì„œ ê²°ì œê°€ ëŠ˜ì–´ë‚˜ëŠ” í¸. â€˜ë³´ë¥˜ ê·œì¹™â€™ì´ íš¨ê³¼ì .",
    S:"ê³„íšê³¼ ì•ˆì •ê°ì„ ì¤‘ì‹œ. ì§€ì¶œì„ í†µì œí•˜ì§€ë§Œ ë•Œë¡œ â€˜í•„ìš”í•œ ì†Œë¹„â€™ë„ ë¯¸ë£° ìˆ˜ ìˆìŒ.",
    E:"ê¸°ë¶„/ìƒí™©ì— ë”°ë¼ ì†Œë¹„ê°€ í”ë“¤ë¦´ ìˆ˜ ìˆìŒ. ê°ì • íŠ¸ë¦¬ê±°ë¥¼ íŒŒì•…í•˜ë©´ ê°œì„ ì´ ë¹ ë¦„.",
    G:"ëª©í‘œ ì¤‘ì‹¬ ì†Œë¹„. ì„±ì¥/ë„êµ¬/í•™ìŠµì— ì§€ì¶œì´ ëª°ë¦´ ìˆ˜ ìˆìœ¼ë‹ˆ ì˜ˆì‚° í”„ë ˆì„ì´ ë„ì›€."
  };

  document.getElementById("calcType").addEventListener("click", ()=>{
    const {scores, top1, top2} = calcType();
    document.getElementById("typeResult").innerHTML = `
      <div class="card" style="box-shadow:none; border:1px solid #eee; background:#fafafa;">
        <div class="pill">ê²°ê³¼</div>
        <h2 style="margin:10px 0 6px;">${typeName[top1]} + ${typeName[top2]}</h2>
        <div class="muted">${typeDesc[top1]}</div>
        <div class="muted" style="margin-top:6px;">ë³´ì¡° ì„±í–¥: ${typeDesc[top2]}</div>
        <h2 style="margin:14px 0 8px;">ì ìˆ˜</h2>
        <div class="muted">
          ${Object.entries(scores).map(([k,v])=>`${typeName[k]}: ${v.toFixed(1)}`).join(" Â· ")}
        </div>
      </div>
    `;
  });

  const $ = (id)=>document.getElementById(id);

  const today = new Date();
  const iso = new Date(today.getTime() - today.getTimezoneOffset()*60000).toISOString().slice(0,10);
  $("dDate").value = iso;

  function regretScore(satis, need){ return (5-Number(satis)) + (5-Number(need)); }

  $("addRow").addEventListener("click", ()=>{
    const row = {
      date: $("dDate").value || iso,
      item: $("dItem").value.trim() || "ê¸°íƒ€",
      amount: Number($("dAmount").value || 0),
      const row = {
  date: $("dDate").value || iso,
  item: $("dItem").value.trim() || "ê¸°íƒ€",
  amount: Number($("dAmount").value || 0),
  category: $("dCategory").value,
  emotion: $("dEmotion").value,
  satis: Number($("dSatis").value),
  need: Number($("dNeed").value)
};
      emotion: $("dEmotion").value,
      satis: Number($("dSatis").value),
      need: Number($("dNeed").value)
    };
    if(!row.amount || row.amount < 0){ alert("ê¸ˆì•¡ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”."); return; }
    state.logs.unshift(row);
    save();
    $("dItem").value = "";
    $("dAmount").value = "";
    renderLogs();
  });

  $("clearLogs").addEventListener("click", ()=>{
    if(confirm("ê¸°ë¡ì„ ëª¨ë‘ ì‚­ì œí• ê¹Œìš”?")){
      state.logs = [];
      save();
      renderLogs();
    }
  });

  function renderLogs(){
    const tb = $("logTbody");
    tb.innerHTML = "";
    state.logs.forEach((r, idx)=>{
      const rs = regretScore(r.satis, r.need);
      const high = rs >= 6;
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${r.date}</td>
        <td>${escapeHtml(r.item)}</td>
        <td class="right">${formatWon(r.amount)}</td>
        <td>${r.emotion}</td>
        <td>${r.satis} / ${r.need}</td>
        <td class="${high?"danger":"ok"}">${high?"ë†’ìŒ":"ë‚®ìŒ"} <span class="muted">(ì ìˆ˜ ${rs})</span></td>
        <td class="right"><button class="ghost" data-del="${idx}" style="padding:6px 10px;">ì‚­ì œ</button></td>
      `;
      tb.appendChild(tr);
    });

    tb.querySelectorAll("button[data-del]").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const i = Number(btn.dataset.del);
        state.logs.splice(i, 1);
        save();
        renderLogs();
      });
    });
  }
function getYYYYMM(dateStr){
  // dateStr: "YYYY-MM-DD"
  if(!dateStr || dateStr.length < 7) return "";
  return dateStr.slice(0,7);
}

function buildMonthOptions(){
  const sel = document.getElementById("monthSelect");
  if(!sel) return;

  const months = new Set();
  const nowMonth = iso.slice(0,7);
  months.add(nowMonth);

  state.logs.forEach(r=>{
    const m = getYYYYMM(r.date);
    if(m) months.add(m);
  });

  const sorted = Array.from(months).sort().reverse();

  // ê¸°ì¡´ ì„ íƒ ìœ ì§€
  const prev = state.uiMonth || nowMonth;

  sel.innerHTML = sorted.map(m => `<option value="${m}">${m}</option>`).join("");

  sel.value = sorted.includes(prev) ? prev : nowMonth;
  state.uiMonth = sel.value;
  save();

  sel.onchange = () => {
    state.uiMonth = sel.value;
    save();
    renderReport();
  };
}

function getSelectedMonth(){
  const sel = document.getElementById("monthSelect");
  return sel?.value || (state.uiMonth || iso.slice(0,7));
}
  function renderReport(){
  buildMonthOptions();
const selectedMonth = getSelectedMonth();
const logs = state.logs.filter(r => getYYYYMM(r.date) === selectedMonth);
    const total = logs.reduce((a,r)=>a+r.amount, 0);
    const avgSatis = logs.length ? (logs.reduce((a,r)=>a+r.satis,0)/logs.length) : 0;
    const regretCnt = logs.filter(r=>regretScore(r.satis,r.need) >= 6).length;
    const regretRate = logs.length ? (regretCnt/logs.length)*100 : 0;

    const emoMap = {};
    logs.forEach(r=> emoMap[r.emotion] = (emoMap[r.emotion]||0)+1 );
    const emoTop = Object.entries(emoMap).sort((a,b)=>b[1]-a[1])[0]?.[0] ?? "-";

    $("kpis").innerHTML = `
      <div class="card" style="box-shadow:none; border:1px solid #eee;">
        <div class="muted">ì´ ì§€ì¶œ</div>
        <div style="font-size:18px; font-weight:700;">${formatWon(total)}</div>
      </div>
      <div class="card" style="box-shadow:none; border:1px solid #eee;">
        <div class="muted">í‰ê·  ë§Œì¡±ë„</div>
        <div style="font-size:18px; font-weight:700;">${avgSatis ? avgSatis.toFixed(1) : "-"}</div>
      </div>
      <div class="card" style="box-shadow:none; border:1px solid #eee;">
        <div class="muted">í›„íšŒìœ¨(ë†’ìŒ)</div>
        <div style="font-size:18px; font-weight:700;">${logs.length ? regretRate.toFixed(0)+"%" : "-"}</div>
      </div>
    `;

    $("emotionTop").innerHTML = logs.length
      ? `<span class="pill">TOP</span> <b>${emoTop}</b> (${emoMap[emoTop]}íšŒ) Â· ì „ì²´ ${logs.length}ê±´`
      : "ê¸°ë¡ì„ ì¶”ê°€í•˜ë©´ í‘œì‹œë©ë‹ˆë‹¤.";

    const lines = [];
    if(!logs.length){
      lines.push("ê¸°ë¡ì´ ì—†ì–´ìš”. ì´ë²ˆ ë‹¬ ì†Œë¹„ë¥¼ 3ê±´ë§Œ ì ì–´ë„ ë¦¬í¬íŠ¸ê°€ ì˜ë¯¸ ìˆì–´ì ¸ìš”.");
    } else {
      if(regretRate >= 25) lines.push("âš  í›„íšŒìœ¨ì´ ë†’ì•„ìš” â†’ ë‹¤ìŒ ë‹¬ì€ â€˜48ì‹œê°„ ë³´ë¥˜ ê·œì¹™â€™ì„ ì ìš©í•´ë³´ì„¸ìš”.");
      if(emoTop === "ìŠ¤íŠ¸ë ˆìŠ¤") lines.push("ğŸ§  ìŠ¤íŠ¸ë ˆìŠ¤ ì†Œë¹„ê°€ ìµœë‹¤ì˜ˆìš” â†’ ëˆ ëŒ€ì‹  í•  ìˆ˜ ìˆëŠ” â€˜ëŒ€ì²´ í–‰ë™ 3ê°€ì§€â€™ë¥¼ ë¯¸ë¦¬ ì •í•´ë‘ì„¸ìš”.");
      if(avgSatis && avgSatis < 3) lines.push("ğŸ“‰ ë§Œì¡±ë„ê°€ ë‚®ì•„ìš” â†’ â€˜ëª©í‘œí˜• ì†Œë¹„(ë„êµ¬/í•™ìŠµ/ê±´ê°•)â€™ ë¹„ìœ¨ì„ ì¡°ê¸ˆ ëŠ˜ë ¤ë³´ì„¸ìš”.");
      if(lines.length === 0) lines.push("âœ… ì „ë°˜ì ìœ¼ë¡œ ì•ˆì •ì ì´ì—ìš” â†’ ë‹¤ìŒ ë‹¬ì€ â€˜í›„íšŒ ì ìˆ˜ 6 ì´ìƒâ€™ ì†Œë¹„ë§Œ ì¤„ì—¬ë„ ì²´ê°ì´ ì»¤ìš”.");
    }
    $("strategy").innerHTML = lines.map(t=>`<div style="margin:6px 0;">${t}</div>`).join("");
  }

  document.getElementById("resetAll").addEventListener("click", ()=>{
    if(confirm("ì§„ë‹¨/ê¸°ë¡ì„ ëª¨ë‘ ì´ˆê¸°í™”í• ê¹Œìš”?")){
      localStorage.removeItem(KEY);
      location.reload();
    }
  });

  function formatWon(n){ try { return Number(n).toLocaleString("ko-KR") + "ì›"; } catch { return n + "ì›"; } }
  function escapeHtml(s){ return s.replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[m])); }

  renderLogs();
</script>
</body>
</html>
function toCsvValue(v){
  const s = String(v ?? "");
  // ì‰¼í‘œ/ë”°ì˜´í‘œ/ì¤„ë°”ê¿ˆ ìˆìœ¼ë©´ ë”°ì˜´í‘œë¡œ ê°ì‹¸ê¸°
  if(/[",\n]/.test(s)){
    return `"${s.replace(/"/g, '""')}"`;
  }
  return s;
}

function downloadCsv(){
  const headers = ["date","item","amount","category","emotion","satis","need"];
  const rows = state.logs.map(r => [
    r.date, r.item, r.amount, r.category, r.emotion, r.satis, r.need
  ]);

  const csv = [
    headers.join(","),
    ...rows.map(row => row.map(toCsvValue).join(","))
  ].join("\n");

  const blob = new Blob([csv], {type:"text/csv;charset=utf-8;"});
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = `spending-${iso}.csv`;
  document.body.appendChild(a);
  a.click();
  a.remove();

  URL.revokeObjectURL(url);
}
document.getElementById("btnDownloadCsv")?.addEventListener("click", downloadCsv);

